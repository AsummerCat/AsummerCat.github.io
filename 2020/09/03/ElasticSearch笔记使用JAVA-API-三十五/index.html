<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/%E9%A3%9E%E5%A4%A9%E5%B0%8F%E5%A5%B3%E8%AD%A6_%E8%8A%B1%E8%8A%B1.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/%E9%A3%9E%E5%A4%A9%E5%B0%8F%E5%A5%B3%E8%AD%A6_%E8%8A%B1%E8%8A%B1.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.geekzu.org/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"www.linjingc.top","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta name="description" content="使用java_apidemodemo地址 注意使用API有两种方式 原生的RestHighLevelClient JPA带的ElasticsearchRepository  12@Autowired   private RestHighLevelClient restHighLevelClient;"><meta property="og:type" content="article"><meta property="og:title" content="ElasticSearch笔记使用JAVA_API(三十五)"><meta property="og:url" content="http://www.linjingc.top/2020/09/03/ElasticSearch%E7%AC%94%E8%AE%B0%E4%BD%BF%E7%94%A8JAVA-API-%E4%B8%89%E5%8D%81%E4%BA%94/index.html"><meta property="og:site_name" content="emmm读书使我快乐"><meta property="og:description" content="使用java_apidemodemo地址 注意使用API有两种方式 原生的RestHighLevelClient JPA带的ElasticsearchRepository  12@Autowired   private RestHighLevelClient restHighLevelClient;"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-09-02T22:51:55.000Z"><meta property="article:modified_time" content="2023-12-06T03:17:10.792Z"><meta property="article:author" content="一只写Bug的猫"><meta property="article:tag" content="elasticSearch笔记"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://www.linjingc.top/2020/09/03/ElasticSearch%E7%AC%94%E8%AE%B0%E4%BD%BF%E7%94%A8JAVA-API-%E4%B8%89%E5%8D%81%E4%BA%94/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://www.linjingc.top/2020/09/03/ElasticSearch%E7%AC%94%E8%AE%B0%E4%BD%BF%E7%94%A8JAVA-API-%E4%B8%89%E5%8D%81%E4%BA%94/","path":"2020/09/03/ElasticSearch笔记使用JAVA-API-三十五/","title":"ElasticSearch笔记使用JAVA_API(三十五)"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>ElasticSearch笔记使用JAVA_API(三十五) | emmm读书使我快乐</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">emmm读书使我快乐</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8java-api"><span class="nav-number">1.</span> <span class="nav-text">使用java_api</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#demo"><span class="nav-number">2.</span> <span class="nav-text">demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BD%BF%E7%94%A8API%E6%9C%89%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-number">3.</span> <span class="nav-text">注意使用API有两种方式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-JPA%E5%B8%A6%E7%9A%84ElasticsearchRepository"><span class="nav-number">4.</span> <span class="nav-text">使用 JPA带的ElasticsearchRepository</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">4.1.</span> <span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9F%E7%9A%84RestHighLevelClient"><span class="nav-number">5.</span> <span class="nav-text">使用原生的RestHighLevelClient</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="nav-number">5.1.</span> <span class="nav-text">创建自定义类型的索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="nav-number">5.2.</span> <span class="nav-text">删除索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="nav-number">5.3.</span> <span class="nav-text">判断索引是否存在</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE"><span class="nav-number">5.4.</span> <span class="nav-text">新增数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="nav-number">5.5.</span> <span class="nav-text">更新数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E5%A2%9Eor%E6%9B%B4%E6%96%B0"><span class="nav-number">5.6.</span> <span class="nav-text">新增or更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2-%E4%B8%80%E6%AC%A1%E6%80%A7%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE-%E4%B8%8D%E5%AD%98%E5%9C%A8%E5%88%99%E4%B8%BAnull"><span class="nav-number">5.7.</span> <span class="nav-text">查询:一次性获取数据 不存在则为null</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Ebulk%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5"><span class="nav-number">5.8.</span> <span class="nav-text">基于bulk批量插入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Ebulk%E6%89%B9%E9%87%8F%E6%9B%B4%E6%96%B0"><span class="nav-number">5.9.</span> <span class="nav-text">基于bulk批量更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Ebulk%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="nav-number">5.10.</span> <span class="nav-text">基于bulk批量删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8Escroll%E5%AE%9E%E7%8E%B0%E6%BB%9A%E5%8A%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.11.</span> <span class="nav-text">基于scroll实现滚动查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E6%90%9C%E7%B4%A2%E6%A8%A1%E6%9D%BF%E5%8E%BB%E5%AE%9E%E7%8E%B0%E6%90%9C%E7%B4%A2"><span class="nav-number">5.12.</span> <span class="nav-text">调用搜索模板去实现搜索</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E4%BA%AE%E6%90%9C%E7%B4%A2"><span class="nav-number">5.13.</span> <span class="nav-text">高亮搜索</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.14.</span> <span class="nav-text">聚合查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%8F%E7%BA%AC%E5%BA%A6%E6%9F%A5%E8%AF%A2location"><span class="nav-number">5.15.</span> <span class="nav-text">经纬度查询location</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E6%90%9C%E7%B4%A2%E7%9A%84%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9"><span class="nav-number">5.16.</span> <span class="nav-text">关于搜索的相关内容</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9B%B4%E5%A4%9A%E6%90%9C%E7%B4%A2%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="nav-number">6.</span> <span class="nav-text">更多搜索的查询语法</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="一只写Bug的猫" src="/img/WechatIMG230.jpeg"><p class="site-author-name" itemprop="name">一只写Bug的猫</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">856</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">212</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://www.linjingc.top/2020/09/03/ElasticSearch%E7%AC%94%E8%AE%B0%E4%BD%BF%E7%94%A8JAVA-API-%E4%B8%89%E5%8D%81%E4%BA%94/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/WechatIMG230.jpeg"><meta itemprop="name" content="一只写Bug的猫"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="emmm读书使我快乐"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="ElasticSearch笔记使用JAVA_API(三十五) | emmm读书使我快乐"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">ElasticSearch笔记使用JAVA_API(三十五)</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-09-02 22:51:55" itemprop="dateCreated datePublished" datetime="2020-09-02T22:51:55Z">2020-09-02</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-12-06 03:17:10" itemprop="dateModified" datetime="2023-12-06T03:17:10Z">2023-12-06</time> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>24k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>22 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="使用java-api"><a href="#使用java-api" class="headerlink" title="使用java_api"></a>使用java_api</h1><h1 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h1><p><a target="_blank" rel="noopener" href="https://github.com/AsummerCat/es_api_demo">demo地址</a></p><h1 id="注意使用API有两种方式"><a href="#注意使用API有两种方式" class="headerlink" title="注意使用API有两种方式"></a>注意使用API有两种方式</h1><ol><li>原生的RestHighLevelClient</li><li>JPA带的ElasticsearchRepository</li></ol><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> RestHighLevelClient restHighLevelClient;</span><br></pre></td></tr></table></figure><span id="more"></span><h1 id="使用-JPA带的ElasticsearchRepository"><a href="#使用-JPA带的ElasticsearchRepository" class="headerlink" title="使用 JPA带的ElasticsearchRepository"></a>使用 JPA带的ElasticsearchRepository</h1><p>需要创建一个实体</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Document</span>(indexName = <span class="string">&quot;user&quot;</span>) <span class="comment">//标记document的index名称</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 必须有id注解</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">    <span class="keyword">private</span> int age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> idCard;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接着创建一个jpa的实体数据层</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Repository</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">PersonRepository</span> <span class="symbol">extends</span> <span class="symbol">ElasticsearchRepository</span>&lt;<span class="symbol">Person</span>, <span class="symbol">String</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">	List&lt;Person&gt; findByName(String keyWord);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">语法类似JPA 可以使用findxxx之类的构建接口</span><br><span class="line"></span><br><span class="line">默认提供增删改查的功能</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">	@Autowired</span><br><span class="line">	<span class="keyword">private</span> PersonRepository personRepository;</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span>()</span> &#123;</span><br><span class="line">		Person person = <span class="keyword">new</span> Person();</span><br><span class="line">		person.setId(UUIDs.base64UUID());</span><br><span class="line">		person.setName(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line">		person.setAge(<span class="number">17</span>);</span><br><span class="line">		personRepository.save(person);</span><br><span class="line">		System.<span class="keyword">out</span>.println(<span class="string">&quot;插入成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><hr><hr><h1 id="使用原生的RestHighLevelClient"><a href="#使用原生的RestHighLevelClient" class="headerlink" title="使用原生的RestHighLevelClient"></a>使用原生的RestHighLevelClient</h1><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> RestHighLevelClient restHighLevelClient;</span><br></pre></td></tr></table></figure><h2 id="创建自定义类型的索引"><a href="#创建自定义类型的索引" class="headerlink" title="创建自定义类型的索引"></a>创建自定义类型的索引</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">	 * 创建自定义索引</span><br><span class="line">	 */</span><br><span class="line">	<span class="meta">public</span> void createIndex() throws IOException &#123;</span><br><span class="line">		XContentBuilder builder=XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">				.startObject</span>()</span><br><span class="line"><span class="meta">				.field</span>(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line"><span class="meta">				.startObject</span>()</span><br><span class="line"><span class="meta">				.field</span>(<span class="string">&quot;name&quot;</span>).startObject().field(<span class="string">&quot;index&quot;</span>,<span class="string">&quot;true&quot;</span>).field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;keyword&quot;</span>).endObject()</span><br><span class="line"><span class="meta">				.field</span>(<span class="string">&quot;age&quot;</span>).startObject().field(<span class="string">&quot;index&quot;</span>,<span class="string">&quot;true&quot;</span>).field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;integer&quot;</span>).endObject()</span><br><span class="line"><span class="meta">				.field</span>(<span class="string">&quot;money&quot;</span>).startObject().field(<span class="string">&quot;index&quot;</span>,<span class="string">&quot;true&quot;</span>).field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;double&quot;</span>).endObject()</span><br><span class="line"><span class="meta">				.field</span>(<span class="string">&quot;address&quot;</span>).startObject().field(<span class="string">&quot;index&quot;</span>,<span class="string">&quot;true&quot;</span>).field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;text&quot;</span>).field(<span class="string">&quot;analyzer&quot;</span>,<span class="string">&quot;ik_max_word&quot;</span>).endObject()</span><br><span class="line"><span class="meta">				.field</span>(<span class="string">&quot;birthday&quot;</span>).startObject().field(<span class="string">&quot;index&quot;</span>,<span class="string">&quot;true&quot;</span>).field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;date&quot;</span>).field(<span class="string">&quot;format&quot;</span>, <span class="string">&quot;strict_date_optional_time||epoch_millis&quot;</span>).endObject()</span><br><span class="line"><span class="meta">				.endObject</span>()</span><br><span class="line"><span class="meta">				.endObject</span>()<span class="comment">;</span></span><br><span class="line">		//注意索引必须是小写</span><br><span class="line">		CreateIndexRequest createIndexRequest = new CreateIndexRequest(<span class="string">&quot;index_name&quot;</span>)<span class="comment">;</span></span><br><span class="line">		createIndexRequest<span class="number">.</span>mapping(builder)<span class="comment">;</span></span><br><span class="line">		CreateIndexResponse createIndexResponse = restHighLevelClient<span class="number">.</span>indices().create(createIndexRequest, RequestOptions<span class="number">.</span><span class="meta">DEFAULT</span>)<span class="comment">;</span></span><br><span class="line">		boolean acknowledged = createIndexResponse<span class="number">.</span>isAcknowledged()<span class="comment">;</span></span><br><span class="line">		if (acknowledged) &#123;</span><br><span class="line">			System<span class="number">.</span><span class="keyword">out</span><span class="number">.</span>println(<span class="string">&quot;索引创建成功&quot;</span>)<span class="comment">;</span></span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			System<span class="number">.</span><span class="keyword">out</span><span class="number">.</span>println(<span class="string">&quot;索引创建失败&quot;</span>)<span class="comment">;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除索引</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> deleteIndex()&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			DeleteIndexRequest deleteIndexRequest = <span class="keyword">new</span> DeleteIndexRequest(<span class="string">&quot;index_name&quot;</span>);</span><br><span class="line">			deleteIndexRequest.indicesOptions(IndicesOptions.LENIENT_EXPAND_OPEN);</span><br><span class="line">			AcknowledgedResponse <span class="keyword">delete</span> = restHighLevelClient.indices().<span class="keyword">delete</span>(deleteIndexRequest, RequestOptions.<span class="keyword">DEFAULT</span>);</span><br><span class="line">			<span class="keyword">boolean</span> acknowledged = <span class="keyword">delete</span>.isAcknowledged();</span><br><span class="line">			<span class="keyword">if</span> (acknowledged) &#123;</span><br><span class="line">				System.out.<span class="keyword">println</span>(<span class="string">&quot;索引删除成功&quot;</span>);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				System.out.<span class="keyword">println</span>(<span class="string">&quot;索引删除失败&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="判断索引是否存在"><a href="#判断索引是否存在" class="headerlink" title="判断索引是否存在"></a>判断索引是否存在</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 判断索引是否存在</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">isIndexExists</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         GetIndexRequest getIndexRequest = <span class="keyword">new</span> <span class="built_in">GetIndexRequest</span>(<span class="string">&quot;index_name&quot;</span>);</span><br><span class="line">         getIndexRequest.<span class="built_in">humanReadable</span>(<span class="literal">true</span>);</span><br><span class="line">         <span class="type">boolean</span> exists = restHighLevelClient.<span class="built_in">indices</span>().<span class="built_in">exists</span>(getIndexRequest, RequestOptions.<span class="literal">DEFAULT</span>);</span><br><span class="line">         <span class="type">String</span> va = exists ? <span class="string">&quot;存在&quot;</span> : <span class="string">&quot;不存在&quot;</span>;</span><br><span class="line">         System.out.<span class="built_in">println</span>(<span class="string">&quot;索引&quot;</span> + va);</span><br><span class="line">     &#125; <span class="built_in">catch</span> (IOException e) &#123;</span><br><span class="line">         e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h2><p>第一种 index语法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方式一 新增数据 index语法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addDataForIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="comment">//索引名称</span></span><br><span class="line">	<span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">	<span class="comment">//可自定义Id</span></span><br><span class="line">       <span class="comment">//indexRequest.id(&quot;111&quot;);</span></span><br><span class="line">       <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">       person.setId(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">       person.setAge(<span class="number">18</span>);</span><br><span class="line">       person.setName(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line">       person.setIdCard(<span class="string">&quot;350123199512161511&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> JSONObject.toJSONString(person);</span><br><span class="line">       <span class="comment">//数据传输格式json</span></span><br><span class="line">	indexRequest.source(userJson, XContentType.JSON);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//构建数据</span></span><br><span class="line">       <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">       <span class="keyword">if</span> (indexResponse != <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> indexResponse.getId();</span><br><span class="line">           <span class="type">String</span> <span class="variable">index</span> <span class="operator">=</span> indexResponse.getIndex();</span><br><span class="line">           <span class="type">long</span> <span class="variable">version</span> <span class="operator">=</span> indexResponse.getVersion();</span><br><span class="line">           <span class="keyword">if</span> (indexResponse.getResult() == DocWriteResponse.Result.CREATED) &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;新增文档成功!&quot;</span> + index + <span class="string">&quot;-&quot;</span> + id + <span class="string">&quot;-&quot;</span> + version);</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (indexResponse.getResult() == DocWriteResponse.Result.UPDATED) &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;修改文档成功!&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// 分片处理信息</span></span><br><span class="line">           ReplicationResponse.<span class="type">ShardInfo</span> <span class="variable">shardInfo</span> <span class="operator">=</span> indexResponse.getShardInfo();</span><br><span class="line">           <span class="keyword">if</span> (shardInfo.getTotal() != shardInfo.getSuccessful()) &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;分片处理信息.....&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// 如果有分片副本失败，可以获得失败原因信息</span></span><br><span class="line">           <span class="keyword">if</span> (shardInfo.getFailed() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="keyword">for</span> (ReplicationResponse.ShardInfo.Failure failure : shardInfo.getFailures()) &#123;</span><br><span class="line">                   <span class="type">String</span> <span class="variable">reason</span> <span class="operator">=</span> failure.reason();</span><br><span class="line">                   System.out.println(<span class="string">&quot;副本失败原因：&quot;</span> + reason);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第二种 upsert语法</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 方式二 新增数据  upsert语法 不存在就新增,存在就更新</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> addData() <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="comment">//构造原有数据</span></span><br><span class="line">      IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(<span class="string">&quot;user&quot;</span>) <span class="comment">//获取index</span></span><br><span class="line">              <span class="comment">//获取id</span></span><br><span class="line">              .id(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">              <span class="comment">//构造field</span></span><br><span class="line">              .<span class="keyword">source</span>(jsonBuilder()</span><br><span class="line">                      .startObject()</span><br><span class="line">                      .field(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小白&quot;</span>)</span><br><span class="line">                      .field(<span class="string">&quot;age&quot;</span>, <span class="number">30</span>)</span><br><span class="line">                      .endObject()</span><br><span class="line">              );</span><br><span class="line">      <span class="comment">//如果是纯插入 这边doc中就不要添加内容</span></span><br><span class="line">      UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">              .doc(XContentFactory.jsonBuilder()</span><br><span class="line">                      .startObject()</span><br><span class="line">                      .endObject()).upsert(indexRequest);</span><br><span class="line">      <span class="comment">//插入</span></span><br><span class="line">      restHighLevelClient.update(updateRequest, RequestOptions.<span class="keyword">DEFAULT</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><p><font color="red">注意: 如果document不存在则不更新</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 更新数据</span></span><br><span class="line"><span class="comment">	 * upsert语法 如果之前信息不存在就insert 存在就update</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateData</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">		<span class="type">UpdateRequest</span> <span class="variable">updateRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">				.doc(XContentFactory.jsonBuilder()</span><br><span class="line">						.startObject()</span><br><span class="line">						.field(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>)</span><br><span class="line">						.endObject());</span><br><span class="line">						<span class="comment">//doc 也可以使用map来封装</span></span><br><span class="line">		<span class="comment">//执行更新语法</span></span><br><span class="line">		DocWriteResponse.<span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> restHighLevelClient.update(updateRequest, RequestOptions.DEFAULT).getResult();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="新增or更新"><a href="#新增or更新" class="headerlink" title="新增or更新"></a>新增or更新</h2><p>upsert语法 如果之前信息不存在就insert 存在就update</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateData</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//构造原有数据</span></span><br><span class="line">       <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;user&quot;</span>) <span class="comment">//获取index</span></span><br><span class="line">               <span class="comment">//获取id</span></span><br><span class="line">               .id(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">               <span class="comment">//构造field</span></span><br><span class="line">               .source(XContentFactory.jsonBuilder()</span><br><span class="line">                       .startObject()</span><br><span class="line">                       .field(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小明&quot;</span>)</span><br><span class="line">                       .field(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)</span><br><span class="line">                       .endObject()</span><br><span class="line">               );</span><br><span class="line">       <span class="comment">//修改后的field的数据</span></span><br><span class="line">       <span class="type">UpdateRequest</span> <span class="variable">updateRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;user&quot;</span>,  <span class="string">&quot;1&quot;</span>)</span><br><span class="line">               .doc(XContentFactory.jsonBuilder()</span><br><span class="line">                       .startObject()</span><br><span class="line">                       .field(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>)</span><br><span class="line">                       .endObject())</span><br><span class="line">                       <span class="comment">//不存在就插入,存在就更新</span></span><br><span class="line">               .upsert(indexRequest);</span><br><span class="line">       <span class="comment">//执行更新语法</span></span><br><span class="line">       restHighLevelClient.update(updateRequest, RequestOptions.DEFAULT).getGetResult();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="查询-一次性获取数据-不存在则为null"><a href="#查询-一次性获取数据-不存在则为null" class="headerlink" title="查询:一次性获取数据 不存在则为null"></a>查询:一次性获取数据 不存在则为null</h2><p>等同于 mget</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">multiGetExists</span>() throws IOException</span> &#123;</span><br><span class="line">        MultiGetRequest items = <span class="keyword">new</span> MultiGetRequest();</span><br><span class="line">        <span class="comment">//拼接数据</span></span><br><span class="line">        items.<span class="keyword">add</span>(<span class="keyword">new</span> MultiGetRequest.Item(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;1&quot;</span>));</span><br><span class="line">        items.<span class="keyword">add</span>(<span class="keyword">new</span> MultiGetRequest.Item(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;2&quot;</span>));</span><br><span class="line">        items.<span class="keyword">add</span>(<span class="keyword">new</span> MultiGetRequest.Item(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;3&quot;</span>));</span><br><span class="line">        items.<span class="keyword">add</span>(<span class="keyword">new</span> MultiGetRequest.Item(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;4&quot;</span>));</span><br><span class="line">        <span class="comment">//GET 多条数据</span></span><br><span class="line">        MultiGetItemResponse[] responses = restHighLevelClient.mget(items, RequestOptions.DEFAULT).getResponses();</span><br><span class="line">        <span class="comment">//返回的结果如果是存在的 输出json</span></span><br><span class="line">        <span class="keyword">for</span> (MultiGetItemResponse respons : responses) &#123;</span><br><span class="line">            GetResponse res = respons.getResponse();</span><br><span class="line">            <span class="comment">//document是否存在</span></span><br><span class="line">            <span class="keyword">if</span>(res.isExists())&#123;</span><br><span class="line">                String json=res.getSourceAsString();</span><br><span class="line">                System.<span class="keyword">out</span>.println(json);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="基于bulk批量插入"><a href="#基于bulk批量插入" class="headerlink" title="基于bulk批量插入"></a>基于bulk批量插入</h2><p><font color="red">增删改的操作 可以在同一个bulk下提交</font></p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * 批处理上传</span><br><span class="line">    * @throws IOException</span><br><span class="line">    */</span><br><span class="line">   <span class="meta">public</span> void bulkBatchAdd() throws IOException &#123;</span><br><span class="line">       BulkRequest bulkRequest = new BulkRequest()<span class="comment">;</span></span><br><span class="line">       //批量构建数据</span><br><span class="line">       bulkRequest<span class="number">.</span><span class="keyword">add</span>(new IndexRequest(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"><span class="meta">               .id</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="meta">               .source</span>(XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">                       .startObject</span>()</span><br><span class="line"><span class="meta">                       .field</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小明&quot;</span>)</span><br><span class="line"><span class="meta">                       .field</span>(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">                       .endObject</span>()</span><br><span class="line">               ))<span class="comment">;</span></span><br><span class="line">       bulkRequest<span class="number">.</span><span class="keyword">add</span>(new IndexRequest(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"><span class="meta">               .id</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line"><span class="meta">               .source</span>(XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">                       .startObject</span>()</span><br><span class="line"><span class="meta">                       .field</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小红&quot;</span>)</span><br><span class="line"><span class="meta">                       .field</span>(<span class="string">&quot;age&quot;</span>, <span class="number">19</span>)</span><br><span class="line"><span class="meta">                       .endObject</span>()</span><br><span class="line">               ))<span class="comment">;</span></span><br><span class="line">       bulkRequest<span class="number">.</span><span class="keyword">add</span>(new IndexRequest(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"><span class="meta">               .id</span>(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"><span class="meta">               .source</span>(XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">                       .startObject</span>()</span><br><span class="line"><span class="meta">                       .field</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小蓝&quot;</span>)</span><br><span class="line"><span class="meta">                       .field</span>(<span class="string">&quot;age&quot;</span>, <span class="number">19</span>)</span><br><span class="line"><span class="meta">                       .endObject</span>()</span><br><span class="line">               ))<span class="comment">;</span></span><br><span class="line">       //提交批处理</span><br><span class="line">       restHighLevelClient<span class="number">.</span>bulk(bulkRequest,RequestOptions<span class="number">.</span><span class="meta">DEFAULT</span>)<span class="comment">;</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="基于bulk批量更新"><a href="#基于bulk批量更新" class="headerlink" title="基于bulk批量更新"></a>基于bulk批量更新</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 批处理更新</span><br><span class="line"> *</span><br><span class="line"> * @throws IOException</span><br><span class="line"> */</span><br><span class="line"><span class="meta">public</span> void bulkBatchUpdate() throws IOException &#123;</span><br><span class="line">	BulkRequest bulkRequest = new BulkRequest()<span class="comment">;</span></span><br><span class="line">	//构造原有数据</span><br><span class="line">	IndexRequest indexRequest1 = new IndexRequest(<span class="string">&quot;user&quot;</span>) //获取index</span><br><span class="line">			//获取id</span><br><span class="line"><span class="meta">			.id</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">			//构造field</span><br><span class="line"><span class="meta">			.source</span>(XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">					.startObject</span>()</span><br><span class="line"><span class="meta">					.field</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小明&quot;</span>)</span><br><span class="line"><span class="meta">					.field</span>(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">					.endObject</span>()</span><br><span class="line">			)<span class="comment">;</span></span><br><span class="line">	IndexRequest indexRequest2 = new IndexRequest(<span class="string">&quot;user&quot;</span>) //获取index</span><br><span class="line">			//获取id</span><br><span class="line"><span class="meta">			.id</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">			//构造field</span><br><span class="line"><span class="meta">			.source</span>(XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">					.startObject</span>()</span><br><span class="line"><span class="meta">					.field</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小东&quot;</span>)</span><br><span class="line"><span class="meta">					.field</span>(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="meta">					.endObject</span>()</span><br><span class="line">			)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	//构造更新的数据</span><br><span class="line">	bulkRequest<span class="number">.</span><span class="keyword">add</span>(new UpdateRequest(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="meta">			.doc</span>(XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">					.startObject</span>()</span><br><span class="line"><span class="meta">					.field</span>(<span class="string">&quot;age&quot;</span>, <span class="number">30</span>)</span><br><span class="line"><span class="meta">					.endObject</span>())</span><br><span class="line">			//不存在就插入,存在就更新</span><br><span class="line"><span class="meta">			.upsert</span>(indexRequest1))<span class="comment">;</span></span><br><span class="line">	bulkRequest<span class="number">.</span><span class="keyword">add</span>(new UpdateRequest(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line"><span class="meta">			.doc</span>(XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">					.startObject</span>()</span><br><span class="line"><span class="meta">					.field</span>(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>)</span><br><span class="line"><span class="meta">					.endObject</span>())</span><br><span class="line"><span class="meta">			.upsert</span>(indexRequest2))<span class="comment">;</span></span><br><span class="line">	//直接更新</span><br><span class="line">	bulkRequest<span class="number">.</span><span class="keyword">add</span>(new UpdateRequest(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line"><span class="meta">			.doc</span>(XContentFactory<span class="number">.</span>jsonBuilder()</span><br><span class="line"><span class="meta">					.startObject</span>()</span><br><span class="line"><span class="meta">					.field</span>(<span class="string">&quot;age&quot;</span>, <span class="number">50</span>)</span><br><span class="line"><span class="meta">					.endObject</span>()))<span class="comment">;</span></span><br><span class="line">        //批处理</span><br><span class="line">	restHighLevelClient<span class="number">.</span>bulk(bulkRequest, RequestOptions<span class="number">.</span><span class="meta">DEFAULT</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="基于bulk批量删除"><a href="#基于bulk批量删除" class="headerlink" title="基于bulk批量删除"></a>基于bulk批量删除</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 批处理删除</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @throws IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bulkBatchDelete</span>() throws IOException</span> &#123;</span><br><span class="line">		BulkRequest bulkRequest = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">		 <span class="comment">//构造插入的数据</span></span><br><span class="line">        bulkRequest.<span class="keyword">add</span>(<span class="keyword">new</span> IndexRequest(<span class="string">&quot;user&quot;</span>) <span class="comment">//获取index</span></span><br><span class="line">		        <span class="comment">//获取id</span></span><br><span class="line">		        .id(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">		        <span class="comment">//构造field</span></span><br><span class="line">		        .source(XContentFactory.jsonBuilder()</span><br><span class="line">				        .startObject()</span><br><span class="line">				        .field(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小明&quot;</span>)</span><br><span class="line">				        .field(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)</span><br><span class="line">				        .endObject()</span><br><span class="line">		        ));</span><br><span class="line">		<span class="comment">//构造删除的数据</span></span><br><span class="line">		bulkRequest.<span class="keyword">add</span>(<span class="keyword">new</span> DeleteRequest(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;1&quot;</span>));</span><br><span class="line">		bulkRequest.<span class="keyword">add</span>(<span class="keyword">new</span> DeleteRequest(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;2&quot;</span>));</span><br><span class="line">		BulkResponse bulk = restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">		<span class="comment">//返回结果处理</span></span><br><span class="line">		BulkItemResponse[] items = bulk.getItems();</span><br><span class="line">		<span class="keyword">for</span> (BulkItemResponse item : items) &#123;</span><br><span class="line">			String statueName = item.getResponse().getResult().name();</span><br><span class="line">			String id = item.getResponse().getId();</span><br><span class="line">			<span class="keyword">if</span>(<span class="string">&quot;DELETED&quot;</span>.<span class="keyword">equals</span>(statueName))&#123;</span><br><span class="line">				System.<span class="keyword">out</span>.println(<span class="string">&quot;id--&gt;&quot;</span>+id+<span class="string">&quot;&lt;--&quot;</span>+<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(<span class="string">&quot;NOT_FOUND&quot;</span>.<span class="keyword">equals</span>(statueName))&#123;</span><br><span class="line">				System.<span class="keyword">out</span>.println(<span class="string">&quot;id--&gt;&quot;</span>+id+<span class="string">&quot;&lt;--&quot;</span>+<span class="string">&quot;删除失败 未找到相关数据&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="基于scroll实现滚动查询"><a href="#基于scroll实现滚动查询" class="headerlink" title="基于scroll实现滚动查询"></a>基于scroll实现滚动查询</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 基于scroll进行滚动查询</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> scrollQuery() <span class="keyword">throws</span> IOException, InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//1.建立查询索引</span></span><br><span class="line">		SearchRequest searchRequest =<span class="keyword">new</span> SearchRequest(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//2.设置scroll的参数</span></span><br><span class="line">		Scroll scroll = <span class="keyword">new</span> Scroll(timeValueMillis(<span class="number">100</span>));</span><br><span class="line">		searchRequest.scroll(scroll);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//3.封装查询条件</span></span><br><span class="line">		SearchSourceBuilder searchSourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line"><span class="comment">//		searchSourceBuilder.query(QueryBuilders.matchQuery(&quot;name&quot;, &quot;小明&quot;));</span></span><br><span class="line">		searchSourceBuilder.query(QueryBuilders.matchAllQuery());</span><br><span class="line">		<span class="comment">//限制单次批量查询的条数</span></span><br><span class="line">		searchSourceBuilder.<span class="keyword">size</span>(<span class="number">1</span>); <span class="comment">//设定每次返回多少条数据</span></span><br><span class="line">		<span class="comment">//设置返回字段和排除字段</span></span><br><span class="line">		searchSourceBuilder.fetchSource(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;id&quot;</span>&#125;,<span class="keyword">null</span>);</span><br><span class="line">		<span class="comment">//排序</span></span><br><span class="line">		searchSourceBuilder.<span class="keyword">sort</span>(<span class="string">&quot;age&quot;</span>, SortOrder.DESC);</span><br><span class="line">		searchRequest.<span class="keyword">source</span>(searchSourceBuilder);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">//4.进行搜索</span></span><br><span class="line">		SearchResponse searchResponse = restHighLevelClient.search(searchRequest,RequestOptions.<span class="keyword">DEFAULT</span>);</span><br><span class="line">		<span class="comment">//获取到scrollId</span></span><br><span class="line">		String scrollId = searchResponse.getScrollId();</span><br><span class="line">		SearchHit[] hits = searchResponse.getHits().getHits();</span><br><span class="line">		List&lt;SearchHit&gt; hitsList = Arrays.stream(hits).<span class="keyword">collect</span>(Collectors.<span class="keyword">toList</span>());</span><br><span class="line">		List&lt;SearchHit&gt; resultSearchHit = <span class="keyword">new</span> ArrayList&lt;&gt;(hitsList);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//5.递归查询并且获取赋值的内容</span></span><br><span class="line">		<span class="keyword">while</span> (!CollectionUtils.isEmpty(hitsList)) &#123;</span><br><span class="line">			<span class="comment">//封装scrollId 接着查询</span></span><br><span class="line">			SearchScrollRequest searchScrollRequest = <span class="keyword">new</span> SearchScrollRequest(scrollId);</span><br><span class="line">			searchScrollRequest.scroll(scroll);</span><br><span class="line">			</span><br><span class="line">			SearchResponse nextResponse = restHighLevelClient.scroll(searchScrollRequest,RequestOptions.<span class="keyword">DEFAULT</span>);</span><br><span class="line">			scrollId = nextResponse.getScrollId();</span><br><span class="line">			hits = nextResponse.getHits().getHits();</span><br><span class="line">			hitsList = Arrays.stream(hits).<span class="keyword">collect</span>(Collectors.<span class="keyword">toList</span>());</span><br><span class="line">			resultSearchHit.addAll(hitsList);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//6.及时清除es快照，释放资源</span></span><br><span class="line">		ClearScrollRequest clearScrollRequest = <span class="keyword">new</span> ClearScrollRequest();</span><br><span class="line">		clearScrollRequest.addScrollId(scrollId);</span><br><span class="line">		<span class="keyword">boolean</span> succeeded=restHighLevelClient.clearScroll(clearScrollRequest,RequestOptions.<span class="keyword">DEFAULT</span>).isSucceeded();</span><br><span class="line">		System.out.<span class="keyword">println</span>(<span class="string">&quot;succeeded:&quot;</span> + succeeded);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//7.最后获取到的数据进行遍历转义成对象</span></span><br><span class="line">		ArrayList&lt;Person&gt; adminLogs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span> (SearchHit hit : resultSearchHit) &#123;</span><br><span class="line">			Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();</span><br><span class="line">			Person person = <span class="keyword">new</span> Person();</span><br><span class="line">			BeanUtilsBean.getInstance().populate(person,sourceAsMap);</span><br><span class="line">			adminLogs.add(person);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//循环展示数据</span></span><br><span class="line">		adminLogs.forEach(System.out::<span class="keyword">println</span>);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="调用搜索模板去实现搜索"><a href="#调用搜索模板去实现搜索" class="headerlink" title="调用搜索模板去实现搜索"></a>调用搜索模板去实现搜索</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基于temp模板进行搜索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSearchTemplate</span>() throws IOException</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 基于temp模板进行搜索</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	SearchTemplateRequest request = <span class="keyword">new</span> SearchTemplateRequest();</span><br><span class="line">	<span class="comment">//调用模板名称</span></span><br><span class="line">	request.setScript(<span class="string">&quot;page_query_by_bard&quot;</span>);</span><br><span class="line">	request.setScriptType(ScriptType.STORED);</span><br><span class="line">	<span class="comment">//封装params参数</span></span><br><span class="line">	Map&lt;String, Object&gt; <span class="keyword">params</span> = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	<span class="keyword">params</span>.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">	<span class="keyword">params</span>.put(<span class="string">&quot;value&quot;</span>, <span class="string">&quot;小明&quot;</span>);</span><br><span class="line">	<span class="keyword">params</span>.put(<span class="string">&quot;size&quot;</span>, <span class="number">5</span>);</span><br><span class="line">	request.setScriptParams(<span class="keyword">params</span>);</span><br><span class="line">	<span class="comment">//添加需要搜索的index</span></span><br><span class="line">	request.setRequest(<span class="keyword">new</span> SearchRequest(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">	<span class="comment">//搜索</span></span><br><span class="line">	SearchTemplateResponse searchTemplateResponse = restHighLevelClient.searchTemplate(request, RequestOptions.DEFAULT);</span><br><span class="line">	SearchHit[] hits = searchTemplateResponse.getResponse().getHits().getHits();</span><br><span class="line">	<span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">		System.<span class="keyword">out</span>.println(hit.getSourceAsString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="高亮搜索"><a href="#高亮搜索" class="headerlink" title="高亮搜索"></a>高亮搜索</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 高亮搜索</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">highlightQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="comment">//1.建立查询索引</span></span><br><span class="line">		<span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		<span class="type">SearchSourceBuilder</span> <span class="variable">searchSourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">		searchSourceBuilder.query(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小&quot;</span>));</span><br><span class="line">		<span class="comment">//2.高亮搜索</span></span><br><span class="line">		<span class="type">HighlightBuilder</span> <span class="variable">highlightBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>();</span><br><span class="line">		<span class="comment">//设置高亮的字段</span></span><br><span class="line">		HighlightBuilder.<span class="type">Field</span> <span class="variable">highlightTitle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>.Field(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		<span class="comment">//字段高亮显示类型，默认用标签包裹高亮字词</span></span><br><span class="line"><span class="comment">//		highlightTitle.highlighterType(&quot;unified&quot;);</span></span><br><span class="line">		<span class="comment">//自定义高亮显示</span></span><br><span class="line">		highlightTitle.preTags(<span class="string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;</span>);</span><br><span class="line">		highlightTitle.postTags(<span class="string">&quot;&lt;/span&gt;&quot;</span>);</span><br><span class="line">		highlightBuilder.field(highlightTitle);</span><br><span class="line">		searchSourceBuilder.highlighter(highlightBuilder);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//3.封装条件进入request</span></span><br><span class="line">		searchRequest.source(searchSourceBuilder);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//4.进行查询</span></span><br><span class="line">		<span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">		<span class="type">SearchHits</span> <span class="variable">hits</span> <span class="operator">=</span> searchResponse.getHits();</span><br><span class="line">		<span class="comment">//获取高亮结果</span></span><br><span class="line">		<span class="keyword">for</span> (SearchHit hit : hits.getHits()) &#123;</span><br><span class="line">			Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">			<span class="type">HighlightField</span> <span class="variable">highlight</span> <span class="operator">=</span> highlightFields.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">			Text[] fragments = highlight.fragments();</span><br><span class="line">			<span class="type">String</span> <span class="variable">fragmentString</span> <span class="operator">=</span> fragments[<span class="number">0</span>].string();</span><br><span class="line">			System.out.println(<span class="string">&quot;输出结果:&quot;</span> + fragmentString);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聚合查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aggSearch</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//创建查询request 并且配上index</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">SearchSourceBuilder</span> <span class="variable">sourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建聚合语法   求各个年龄段分组</span></span><br><span class="line">        <span class="type">TermsAggregationBuilder</span> <span class="variable">termsAggregationBuilder</span> <span class="operator">=</span> AggregationBuilders.terms(<span class="string">&quot;by_age&quot;</span>).field(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        <span class="comment">//求平均年龄</span></span><br><span class="line"><span class="comment">// TermsAggregationBuilder termsAggregationBuilder = AggregationBuilders.avg(&quot;avg_age&quot;).field(&quot;age&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加到查询源中</span></span><br><span class="line">        sourceBuilder.aggregation(termsAggregationBuilder);</span><br><span class="line">        sourceBuilder.timeout(<span class="keyword">new</span> <span class="title class_">TimeValue</span>(<span class="number">60</span>, TimeUnit.SECONDS));</span><br><span class="line">        <span class="comment">//添加到查询request</span></span><br><span class="line">        searchRequest.source(sourceBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//查询</span></span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">            <span class="comment">//获取当前聚合搜索结果</span></span><br><span class="line">            <span class="type">Aggregations</span> <span class="variable">aggregations</span> <span class="operator">=</span> searchResponse.getAggregations();</span><br><span class="line">            <span class="comment">//获取当前层级的聚合</span></span><br><span class="line">            Map&lt;String, Aggregation&gt; stringAggregationMap = aggregations.asMap();</span><br><span class="line">            <span class="comment">//获取指定聚合名称的结果集</span></span><br><span class="line">            <span class="type">ParsedLongTerms</span> <span class="variable">parsedLongTerms</span> <span class="operator">=</span> (ParsedLongTerms) stringAggregationMap.get(<span class="string">&quot;by_age&quot;</span>);</span><br><span class="line">            <span class="comment">//遍历结果集渲染的列表</span></span><br><span class="line">            List&lt;? <span class="keyword">extends</span> <span class="title class_">Terms</span>.Bucket&gt; buckets = parsedLongTerms.getBuckets();</span><br><span class="line"></span><br><span class="line">            Map&lt;Integer, Long&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">//遍历聚合查询的结果</span></span><br><span class="line">            <span class="keyword">for</span> (Terms.Bucket bucket : buckets) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">docCount</span> <span class="operator">=</span> bucket.getDocCount();<span class="comment">//个数</span></span><br><span class="line">                <span class="type">Number</span> <span class="variable">keyAsNumber</span> <span class="operator">=</span> bucket.getKeyAsNumber();<span class="comment">//年龄</span></span><br><span class="line">                System.err.println(keyAsNumber + <span class="string">&quot;岁的有&quot;</span> + docCount + <span class="string">&quot;个&quot;</span>);</span><br><span class="line">                map.put(keyAsNumber.intValue(), docCount);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;聚合查询成功&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="经纬度查询location"><a href="#经纬度查询location" class="headerlink" title="经纬度查询location"></a>经纬度查询location</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment"><span class="language-markdown">/**</span></span></span><br><span class="line"><span class="language-markdown"><span class="comment"><span class="bullet">     *</span> 经纬度查询 location</span></span></span><br><span class="line"><span class="language-markdown"><span class="comment"><span class="code">     */</span></span></span></span><br><span class="line">    public <span class="keyword">void</span> locationSearch()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拼接条件</span></span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line"><span class="comment">//        QueryBuilder isdeleteBuilder = QueryBuilders.termQuery(&quot;isdelete&quot;, false);</span></span><br><span class="line">        <span class="comment">// 以某点为中心，搜索指定范围   字段名称</span></span><br><span class="line">        GeoDistanceQueryBuilder distanceQueryBuilder = <span class="keyword">new</span> GeoDistanceQueryBuilder(<span class="string">&quot;location&quot;</span>);</span><br><span class="line">        <span class="comment">//构建一个带你</span></span><br><span class="line">        distanceQueryBuilder.point(<span class="number">42.12</span>D, <span class="number">-73</span>);</span><br><span class="line">        <span class="comment">//查询单位：km</span></span><br><span class="line">        distanceQueryBuilder.distance(<span class="number">100</span>, DistanceUnit.KILOMETERS);</span><br><span class="line">        boolQueryBuilder.filter(distanceQueryBuilder);</span><br><span class="line"><span class="comment">//        boolQueryBuilder.must(isdeleteBuilder);</span></span><br><span class="line"></span><br><span class="line">        SearchSourceBuilder searchSourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        searchSourceBuilder.query(boolQueryBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询Request 附带index</span></span><br><span class="line">        SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">&quot;my_index&quot;</span>);</span><br><span class="line">        searchRequest.source(searchSourceBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SearchResponse searchResponse = restHighLevelClient.search(searchRequest,RequestOptions.DEFAULT);</span><br><span class="line">            SearchHits hits = searchResponse.getHits();</span><br><span class="line">            <span class="built_in">List</span>&lt;SearchHit&gt; hitsList = Arrays.stream(hits.getHits()).collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; hitsList.size(); i++) &#123;</span><br><span class="line">                <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; sourceAsMap = hitsList.<span class="keyword">get</span>(i).getSourceAsMap();</span><br><span class="line">                System.out.<span class="built_in">print</span>(<span class="string">&quot;输出语句:&quot;</span>+sourceAsMap.<span class="keyword">get</span>(<span class="string">&quot;text&quot;</span>)+<span class="string">&quot;---&quot;</span>);</span><br><span class="line">                <span class="comment">//获取具体坐标</span></span><br><span class="line">                <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Double&gt; localtion = (<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Double&gt;) MapUtils.getMap(sourceAsMap, <span class="string">&quot;location&quot;</span>);</span><br><span class="line">                System.out.<span class="built_in">print</span>(<span class="string">&quot;当前位置&quot;</span>+localtion.<span class="keyword">get</span>(<span class="string">&quot;lat&quot;</span>)+<span class="string">&quot;,&quot;</span>+localtion.<span class="keyword">get</span>(<span class="string">&quot;lon&quot;</span>));</span><br><span class="line">                System.out.println();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="关于搜索的相关内容"><a href="#关于搜索的相关内容" class="headerlink" title="关于搜索的相关内容"></a>关于搜索的相关内容</h2><p>search查询的返回值为SearchResponse，调用SearchResponse的getHits()方法会获取SearchHits对象，然后再通过SearchHits的getHits()方法即返回一个SearchHit[]数组。</p><p>遍历SearchHit[]数组获取每一个对象，通过hit.getScore()可获取分数，即搜索匹配度。通过hit.getSourceAsString()可得到对象的json字符串。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchHits</span> <span class="variable">hits</span> <span class="operator">=</span> searchResponse.getHits();</span><br><span class="line"><span class="type">long</span> <span class="variable">totalHits</span> <span class="operator">=</span> hits.getTotalHits(); <span class="comment">//查询命中总数</span></span><br><span class="line"><span class="type">float</span> <span class="variable">maxScore</span> <span class="operator">=</span> hits.getMaxScore(); <span class="comment">//查询命中的最高分数</span></span><br><span class="line"><span class="comment">//嵌套在SearchHits可以迭代获取单个搜索结果中</span></span><br><span class="line">SearchHit[] searchHits = hits.getHits();</span><br><span class="line"><span class="keyword">for</span> (SearchHit hit : searchHits) &#123;</span><br><span class="line">    <span class="comment">//使用SearchHit做一些事情</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//通过SearchHit还可以获取 返回数据 的索引、类型、docId和得分等基本信息</span></span><br><span class="line"><span class="type">String</span> <span class="variable">index</span> <span class="operator">=</span> hit.getIndex(); </span><br><span class="line"><span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> hit.getType();</span><br><span class="line"><span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> hit.getId();</span><br><span class="line"><span class="type">float</span> <span class="variable">score</span> <span class="operator">=</span> hit.getScore();</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><hr><hr><h1 id="更多搜索的查询语法"><a href="#更多搜索的查询语法" class="headerlink" title="更多搜索的查询语法"></a>更多搜索的查询语法</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"><span class="bullet">   *</span> <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">***</span></span><br><span class="line"><span class="strong">   * **</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="emphasis">*更多的搜索语法<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>*</span>*</span><br><span class="line"><span class="bullet">   *</span> <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">*更多的搜索语法*</span>**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">***</span></span><br><span class="line"><span class="strong">   * **</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="emphasis">*更多的搜索语法<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>*</span>*</span><br><span class="line"><span class="bullet">   *</span> <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">***</span></span><br><span class="line"><span class="strong">   <span class="emphasis">*/</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">  public void SearchMove() &#123;</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //1.建立查询索引</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      SearchRequest searchRequest = new SearchRequest(&quot;user&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //2.搜索语法</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //封装查询条件</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //查询所有</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      searchSourceBuilder.query(QueryBuilders.matchAllQuery());</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //match查询</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      searchSourceBuilder.query(QueryBuilders.matchQuery(&quot;name&quot;, &quot;小明&quot;));</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //term查询</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      searchSourceBuilder.query(QueryBuilders.termQuery(&quot;name&quot;, &quot;小明&quot;));</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //2.1 bool语法查询 start</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      // 绑定查询条件</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      // status字段为301或302</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      boolQueryBuilder.must(QueryBuilders.termsQuery(&quot;status.keyword&quot;, new String[]&#123;&quot;301&quot;, &quot;302&quot;&#125;));</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      // args字段包含786754748671257</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      boolQueryBuilder.must(QueryBuilders.matchPhraseQuery(&quot;args&quot;, &quot;786754748671257&quot;));</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      // 时间大于等于2020-05-21 00:00:00，小于2020-05-22 00:00:00</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      boolQueryBuilder.must(QueryBuilders.rangeQuery(&quot;@timestamp&quot;).gte((&quot;2020-05-21 00:00:00&quot;)).lt((&quot;2020-05-22 00:00:00&quot;)));</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"></span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      /*</span>*</span></span><br><span class="line"><span class="strong">       **</span><span class="strong">****</span><span class="strong">***</span></span><br><span class="line"><span class="strong">       * 该部分可以放入boolQueryBuilder中</span></span><br><span class="line"><span class="strong">       <span class="emphasis">*/</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //范围查询</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      RangeQueryBuilder rangeQueryBuilder = QueryBuilders.rangeQuery(&quot;birthday&quot;).from(&quot;1991-01-01&quot;).to(&quot;2010-10-10&quot;).format(&quot;yyyy-MM-dd&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //闭区间查询</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      QueryBuilder queryBuilder0 = QueryBuilders.rangeQuery(&quot;fieldName&quot;).from(&quot;fieldValue1&quot;).to(&quot;fieldValue2&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //开区间查询</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      QueryBuilder queryBuilder1 = QueryBuilders.rangeQuery(&quot;fieldName&quot;).from(&quot;fieldValue1&quot;).to(&quot;fieldValue2&quot;).includeUpper(false).includeLower(false);//默认是true，也就是包含</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //大于</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      QueryBuilder queryBuilder2 = QueryBuilders.rangeQuery(&quot;fieldName&quot;).gt(&quot;fieldValue&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //大于等于</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      QueryBuilder queryBuilder3 = QueryBuilders.rangeQuery(&quot;fieldName&quot;).gte(&quot;fieldValue&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //小于</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      QueryBuilder queryBuilder4 = QueryBuilders.rangeQuery(&quot;fieldName&quot;).lt(&quot;fieldValue&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //小于等于</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      QueryBuilder queryBuilder5 = QueryBuilders.rangeQuery(&quot;fieldName&quot;).lte(&quot;fieldValue&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      </span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //精准查询</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery(&quot;name.keyword&quot;, &quot;小明&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //前缀查询</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      PrefixQueryBuilder prefixQueryBuilder = QueryBuilders.prefixQuery(&quot;name.keyword&quot;, &quot;张&quot;);</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      //通配符查询</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">      WildcardQueryBuilder wildcardQueryBuilder = QueryBuilders.wildcardQuery(&quot;name.keyword&quot;, &quot;*</span>三&quot;);</span></span><br><span class="line"><span class="strong">      //模糊查询</span></span><br><span class="line"><span class="strong">      FuzzyQueryBuilder fuzzyQueryBuilder = QueryBuilders.fuzzyQuery(&quot;name&quot;, &quot;三&quot;);</span></span><br><span class="line"><span class="strong">      //按照年龄排序</span></span><br><span class="line"><span class="strong">      FieldSortBuilder fieldSortBuilder = SortBuilders.fieldSort(&quot;age&quot;);</span></span><br><span class="line"><span class="strong">      //从小到大排序</span></span><br><span class="line"><span class="strong">      fieldSortBuilder.sortMode(SortMode.MIN);</span></span><br><span class="line"><span class="strong">      //and or  查询</span></span><br><span class="line"><span class="strong">      boolQueryBuilder.must(rangeQueryBuilder).should(prefixQueryBuilder);</span></span><br><span class="line"><span class="strong">      // 2.1 bool语法查询   绑定bool query   end</span></span><br><span class="line"><span class="strong">      searchSourceBuilder.query(boolQueryBuilder).sort(fieldSortBuilder);//多条件查询</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">      //高亮搜索</span></span><br><span class="line"><span class="strong">      HighlightBuilder highlightBuilder = new HighlightBuilder();</span></span><br><span class="line"><span class="strong">      HighlightBuilder.Field highlightTitle = new HighlightBuilder.Field(&quot;title&quot;);</span></span><br><span class="line"><span class="strong">      //字段高亮显示类型，默认用标签包裹高亮字词</span></span><br><span class="line"><span class="strong">      highlightTitle.highlighterType(&quot;unified&quot;);</span></span><br><span class="line"><span class="strong">      highlightBuilder.field(highlightTitle);</span></span><br><span class="line"><span class="strong">      searchSourceBuilder.highlighter(highlightBuilder);</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">      // 准确计数</span></span><br><span class="line"><span class="strong">      searchSourceBuilder.trackTotalHits(true);</span></span><br><span class="line"><span class="strong">      // 超时时间60s</span></span><br><span class="line"><span class="strong">      searchSourceBuilder.timeout(new TimeValue(60, TimeUnit.SECONDS));</span></span><br><span class="line"><span class="strong">      //设置返回字段和排除字段</span></span><br><span class="line"><span class="strong">      searchSourceBuilder.fetchSource(new String[]&#123;&quot;name&quot;, &quot;age&quot;, &quot;id&quot;&#125;, null);</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">      //排序</span></span><br><span class="line"><span class="strong">      searchSourceBuilder.sort(&quot;age&quot;, SortOrder.DESC);</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">      //设定每次返回多少条数据</span></span><br><span class="line"><span class="strong">      searchSourceBuilder.size(1);</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">      /**</span></span><br><span class="line"><span class="bullet">       *</span> <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>*</span><br><span class="line"><span class="bullet">       *</span> <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>封装request+查询<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>*</span><br><span class="line"><span class="bullet">       *</span> <span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>*</span><br><span class="line"><span class="code">       */</span></span><br><span class="line"><span class="code">      //4.将查询内容封装request</span></span><br><span class="line"><span class="code">      searchRequest.source(searchSourceBuilder);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"></span><br><span class="line"><span class="code">      //5.进行搜索</span></span><br><span class="line"><span class="code">      try &#123;</span></span><br><span class="line"><span class="code">          SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span></span><br><span class="line"><span class="code">          SearchHit[] hits = searchResponse.getHits().getHits();</span></span><br><span class="line"><span class="code">          //获取返回值</span></span><br><span class="line"><span class="code">          List&lt;SearchHit&gt; hitsList = Arrays.stream(hits).collect(Collectors.toList());</span></span><br><span class="line"><span class="code">          //7.最后获取到的数据进行遍历转义成对象</span></span><br><span class="line"><span class="code">          ArrayList&lt;Person&gt; adminLogs = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="code">          //根据返回值转换为实体类</span></span><br><span class="line"><span class="code">          for (SearchHit hit : hitsList) &#123;</span></span><br><span class="line"><span class="code">              Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();</span></span><br><span class="line"><span class="code">              Person person = new Person();</span></span><br><span class="line"><span class="code">              BeanUtilsBean.getInstance().populate(person, sourceAsMap);</span></span><br><span class="line"><span class="code">              adminLogs.add(person);</span></span><br><span class="line"><span class="code">          &#125;</span></span><br><span class="line"><span class="code">      &#125; catch (IOException | IllegalAccessException | InvocationTargetException e) &#123;</span></span><br><span class="line"><span class="code">          e.printStackTrace();</span></span><br><span class="line"><span class="code">      &#125;</span></span><br><span class="line"><span class="code">      /**</span></span><br><span class="line"><span class="code">       * *********************************************</span></span><br><span class="line"><span class="code">       * ************封装request+查询*****************</span></span><br><span class="line"><span class="code">       * *********************************************</span></span><br><span class="line"><span class="code">       */</span></span><br><span class="line"><span class="code">  &#125;</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-tags"><a href="/tags/elasticSearch%E7%AC%94%E8%AE%B0/" rel="tag"># elasticSearch笔记</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/09/02/ElasticSearch%E7%AC%94%E8%AE%B0%E4%BD%BF%E7%94%A8%E6%95%B4%E5%90%88SpringBoot-%E4%B8%89%E5%8D%81%E5%9B%9B/" rel="prev" title="ElasticSearch笔记使用整合SpringBoot(三十四)"><i class="fa fa-angle-left"></i> ElasticSearch笔记使用整合SpringBoot(三十四)</a></div><div class="post-nav-item"><a href="/2020/09/04/ElasticSearch%E7%AC%94%E8%AE%B0%E8%BF%90%E7%BB%B4%E7%A1%AC%E4%BB%B6%E5%92%8CJVM-%E4%B8%89%E5%8D%81%E5%85%AD/" rel="next" title="ElasticSearch笔记运维硬件和JVM(三十六)">ElasticSearch笔记运维硬件和JVM(三十六) <i class="fa fa-angle-right"></i></a></div></div></footer></article></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">一只写Bug的猫</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">2.8m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">41:48</span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/AsummerCat/AsmmerCatHexo" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();</script></body></html>